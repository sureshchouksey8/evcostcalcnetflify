<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>EV Cost Advisor — India (AI-ready)</title>
<style>
  :root{
    --bg:#f6f7fb; --card:#fff; --text:#0b1220; --muted:#334155; --line:rgba(15,23,42,.14);
    --soft:#f1f5f9; --ring:#e2e8f0; --ok:#16a34a; --bad:#dc2626; --accent:#0ea5e9;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:var(--text);background:#fff;font-size:17px;line-height:1.5}

  /* layout spacing (more breathing room) */
  .container{max-width:1200px;margin:0 auto;padding:28px 20px 110px}
  h1{margin:0;font-size:clamp(28px,3.5vw,38px);font-weight:900;background:linear-gradient(90deg,#16a34a,#0ea5e9);-webkit-background-clip:text;background-clip:text;color:transparent}
  .subtitle{color:var(--muted);font-size:clamp(14px,2vw,16px);margin-top:10px}
  .row{display:flex;gap:14px;align-items:center;justify-content:space-between;flex-wrap:wrap}
  .pills{display:flex;gap:12px}
  .pill{border:1px solid var(--line);background:#fff;border-radius:999px;padding:9px 14px;color:var(--muted);font-size:13px}

  .tabs{display:inline-flex;border:1px solid var(--line);border-radius:14px;background:#fff;padding:6px;margin-top:16px}
  .tabs button{border:none;background:transparent;color:var(--text);padding:10px 14px;border-radius:12px;font-size:15px;cursor:pointer}
  .tabs button.active{background:var(--soft);border:1px solid var(--line)}

  .tip{margin-top:14px;padding:12px 14px;background:#e6f6ef;border:1px solid #c6f6d5;border-radius:12px;color:#065f46;font-size:15px}

  .search{margin:20px 0}
  .search input{width:100%;border-radius:16px;padding:14px 16px;background:#fff;border:1px solid var(--line);color:var(--text);font-size:16px}

  .grid{display:grid;grid-template-columns:repeat(1,minmax(0,1fr));gap:20px}
  @media(min-width:640px){.grid{grid-template-columns:repeat(2,1fr)}}
  @media(min-width:1024px){.grid{grid-template-columns:repeat(3,1fr)}}
  @media(min-width:1280px){.grid{grid-template-columns:repeat(4,1fr)}}

  .card{border:1px solid var(--line);background:var(--card);border-radius:20px;padding:18px;box-shadow:0 8px 26px rgba(2,6,23,.06);text-align:left;cursor:pointer}
  .card:hover{outline:2px solid rgba(16,185,129,.28)}
  .small{font-size:14px;color:var(--muted)}
  .muted{color:var(--muted)}
  .bold{font-weight:800}

  .badge,.badge-btn{display:inline-flex;gap:6px;align-items:center;padding:5px 12px;border-radius:999px;border:1px solid var(--line);background:#fff;font-size:12px;color:var(--muted)}
  .badge-btn{cursor:pointer}
  .button{border:none;background:#0f172a;color:#e5e7eb;border:1px solid rgba(15,23,42,.18);padding:11px 16px;border-radius:12px;cursor:pointer;font-weight:700}
  .button.primary{background:#16a34a;border-color:rgba(22,163,74,.4);color:#052e16}
  .ring{border:1px solid var(--ring)}

  /* Modal */
  .overlay{position:fixed;inset:0;background:rgba(0,0,0,.72);backdrop-filter:blur(4px);display:none;align-items:center;justify-content:center;z-index:50;padding:10px}
  .overlay.show{display:flex}
  .modal{width:min(1200px,98vw);max-height:92vh;display:flex;flex-direction:column;background:#fff;color:var(--text);border:1px solid var(--ring);border-radius:22px;overflow:hidden;box-shadow:0 24px 70px rgba(2,6,23,.32)}
  @media(max-width:640px){.modal{width:100vw;height:100vh;max-height:none;border-radius:18px}}
  .modal-head{display:flex;align-items:center;justify-content:space-between;padding:14px 18px;border-bottom:1px solid var(--ring);background:var(--soft);gap:12px;flex-wrap:wrap}
  .modal-body{padding:18px 18px 26px;overflow:auto;-webkit-overflow-scrolling:touch;touch-action:pan-y}

  .grid3{display:grid;grid-template-columns:1fr;gap:22px}
  @media(min-width:1024px){.grid3{grid-template-columns:1.2fr 1.6fr 1.1fr}}

  .input,select{width:100%;border-radius:14px;padding:12px 12px;background:#fff;border:1px solid var(--line);color:var(--text);font-size:16px}
  .tile{border-radius:20px;padding:20px;color:#fff}
  .tile.ev{background:#059669} .tile.ice{background:#dc2626}
  .tile .big{font-size:clamp(44px,5.2vw,60px);font-weight:900;margin-top:4px}
  .bar{height:14px;border-radius:999px;background:rgba(2,6,23,.06);overflow:hidden}
  .bar .fill{height:100%;transition:width .6s ease}

  .stat{background:#fff;border:1px solid var(--ring);border-radius:20px;padding:18px}
  .gauge{width:180px;height:180px}
  #gProg{transition:stroke-dasharray .8s ease, stroke .3s ease}

  .right-rail{display:flex;flex-direction:column;align-items:center;text-align:center;gap:12px}
  .right-rail .good{display:inline-flex;gap:8px;align-items:center;background:rgba(16,185,129,.18);border:1px solid rgba(16,185,129,.35);color:#065f46;border-radius:999px;padding:6px 12px;animation:bounce 1.3s infinite;font-size:14px}
  @keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-2px)}}

  input[type=range]{-webkit-appearance:none;appearance:none;width:100%;height:16px;background:transparent}
  input[type=range]::-webkit-slider-runnable-track{height:8px;background:#e5e7eb;border-radius:999px}
  input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;margin-top:-8px;width:28px;height:28px;border-radius:50%;background:#16a34a;border:2px solid #065f46;box-shadow:0 2px 6px rgba(0,0,0,.2)}
  input[type=range]::-moz-range-track{height:8px;background:#e5e7eb;border-radius:999px}
  input[type=range]::-moz-range-thumb{width:28px;height:28px;border-radius:50%;background:#16a34a;border:2px solid #065f46}

  .tabnums{font-variant-numeric:tabular-nums;font-feature-settings:'tnum' 1}

  /* Tools (solid colours) */
  .toolsGrid{display:grid;grid-template-columns:1fr;gap:18px}
  @media(min-width:800px){.toolsGrid{grid-template-columns:1fr 1fr}}
  .toolTile{border-radius:20px;padding:20px;color:#fff;border:1px solid rgba(255,255,255,.25)}
  .toolTile h3{margin:0 0 10px 0;font-size:15px;letter-spacing:.12em;text-transform:uppercase;opacity:.95}
  .toolTile .row{align-items:flex-end}
  .toolTile .value{font-size:28px;font-weight:900}
  .toolTile .caption{font-size:13px;opacity:.97}
  .toolTile input{background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.45);color:#fff}
  .toolTile.emi{background:linear-gradient(135deg,#0ea5e9,#22d3ee)}
  .toolTile.litres{background:linear-gradient(135deg,#10b981,#059669)}

  #aiPanel{margin-top:12px;border:1px dashed var(--ring);padding:12px;border-radius:12px;background:#f8fafc;display:none}
  #aiPanel.good{border-color:#a7f3d0;background:#ecfdf5}
  #aiPanel.try{border-color:#fde68a;background:#fffbeb}

  /* optional model photo (shows above gauge if present) */
  #modelPhoto{
    width:100%;max-height:220px;object-fit:cover;border-radius:14px;display:none;border:1px solid var(--ring);
  }

  .mt4{margin-top:4px}.mt8{margin-top:8px}.mt12{margin-top:12px}.mt16{margin-top:16px}
  .mt20{margin-top:20px}.mt24{margin-top:24px}
</style>
</head>
<body>
  <div class="container">
    <div class="row">
      <div>
        <h1>EV Cost Advisor — India</h1>
        <div class="subtitle">Compare <span class="bold">per-day</span> EV vs petrol running costs. Select a model to begin.</div>
      </div>
      <div class="pills"><div class="pill">🇮🇳 India</div><div class="pill">⚡ EV</div><div class="pill">₹/day first</div></div>
    </div>

    <div class="tabs">
      <button id="tab-cars" class="active">Cars</button>
      <button id="tab-scooters">Scooters</button>
    </div>

    <div class="tip">💡 Tip: Pick a model → set km/day → compare EV vs Petrol. Share a WhatsApp-ready image from the calculator.</div>

    <div class="search">
      <input id="q" placeholder="Search brand, model, segment..." />
      <div id="resultCount" class="small mt8 muted"></div>
    </div>

    <div id="grid" class="grid"></div>
  </div>

  <!-- Calculator Modal -->
  <div id="overlay" class="overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modal-head">
        <div class="row" style="gap:10px">
          <button id="infoBtn" class="badge-btn" title="How this is calculated">i Info</button>
          <button id="emiBtn" class="button">EMI</button>
          <button id="aiBtn" class="button" title="AI suggestion">✨ AI Analysis</button>
        </div>
        <div class="row">
          <button id="shareBtn" class="button">Share</button>
          <button id="closeBtn" class="button">Close</button>
        </div>
      </div>
      <div class="modal-body">
        <div class="grid3">
          <!-- Left controls -->
          <div>
            <label class="small muted">City preset</label>
            <select id="citySel" class="mt8 input"></select>
            <div class="small mt8">Tariff: <span id="tariffView" class="tabnums">—</span> /kWh</div>

            <div class="mt16">
              <div class="row" style="justify-content:flex-start;gap:10px">
                <label class="small muted">Daily drive (km)</label>
                <span class="badge">Kitna Chalaoge?</span>
              </div>
              <input id="kmRange" type="range" min="0" max="200" step="1" value="20" class="mt8" />
              <div class="small muted mt8"><span id="kmVal" class="tabnums">20</span> km/day</div>
            </div>

            <div class="mt16">
              <label class="small muted">Petrol price (₹/L)</label>
              <input id="petrolIn" type="number" class="input mt8" value="100" />
            </div>
          </div>

          <!-- Center: tiles + days slider + stats -->
          <div>
            <div class="row" style="justify-content:flex-start;gap:10px"><span class="badge">Kitna Kharchoge?</span></div>
            <div class="tile ev mt8">
              <div class="small" style="letter-spacing:.12em;text-transform:uppercase;opacity:.95">Cost per day (EV)</div>
              <div id="perDayEv" class="big tabnums">—</div>
              <div class="small" id="kmNoteEv">For 20 km/day</div>
            </div>
            <div class="tile ice mt16">
              <div class="small" style="letter-spacing:.12em;text-transform:uppercase;opacity:.95">Cost per day (Petrol)</div>
              <div id="perDayIce" class="big tabnums">—</div>
              <div class="small" id="kmNoteIce">For 20 km/day</div>
            </div>

            <!-- Days slider -->
            <div class="mt20" id="daysBlockCenter">
              <div class="row" style="gap:10px;align-items:center">
                <label class="small muted">Days per month</label>
                <div class="badge tabnums" id="daysBadge">26 days</div>
              </div>
              <input id="daysRange" type="range" min="1" max="31" step="1" value="26" class="mt8" />
            </div>

            <div class="row mt24">
              <div id="statMonthly" class="stat clickable" style="flex:1">
                <div class="row small muted"><span>Monthly running cost</span><span id="monthlyPair" class="tabnums">—</span></div>
                <div class="bar mt12"><div id="barEvM" class="fill" style="background:#16a34a;width:0%"></div></div>
                <div class="bar mt8"><div id="barIceM" class="fill" style="background:#ef4444;width:0%"></div></div>
              </div>
              <div id="statYearly" class="stat clickable" style="flex:1">
                <div class="row small muted"><span>Yearly running cost</span><span id="yearlyPair" class="tabnums">—</span></div>
                <div class="bar mt12"><div id="barEvY" class="fill" style="background:#16a34a;width:0%"></div></div>
                <div class="bar mt8"><div id="barIceY" class="fill" style="background:#ef4444;width:0%"></div></div>
              </div>
            </div>
          </div>

          <!-- Right: (optional) photo + savings circle + model info + AI panel -->
          <div class="right-rail">
            <img id="modelPhoto" alt="">
            <svg class="gauge" viewBox="0 0 120 120">
              <circle cx="60" cy="60" r="50" fill="none" stroke="#cbd5e1" stroke-width="12" stroke-opacity=".6"/>
              <g transform="rotate(-90 60 60)">
                <circle id="gProg" cx="60" cy="60" r="50" fill="none" stroke="#16a34a" stroke-width="12" stroke-linecap="round" stroke-dasharray="0 314"/>
              </g>
              <text id="gLabel" x="60" y="56" text-anchor="middle" fill="#0f172a" font-size="22" font-weight="800">—</text>
              <text id="gSub" x="60" y="80" text-anchor="middle" fill="#475569" font-size="12">Savings vs petrol</text>
            </svg>
            <div class="stat" style="text-align:center">
              <div id="modelName" style="font-weight:800;font-size:18px">—</div>
              <div id="modelInfo" class="small muted mt8">—</div>
              <div class="small muted mt8">Monthly savings</div>
              <div id="saveMonth" class="bold tabnums mt4" style="font-size:22px">—</div>
              <div id="goodFit" class="good mt8" style="display:none">👍 Good fit</div>
            </div>
            <div id="aiPanel" class="mt8">
              <div id="aiVerdict" class="bold">AI analysis</div>
              <div id="aiReasons" class="small mt8"></div>
              <div id="aiAlt" class="small mt8"></div>
              <label class="small mt8" style="display:inline-flex;gap:6px;align-items:center"><input id="aiAddShare" type="checkbox" /> Add AI line to share card</label>
            </div>
            <button id="openShare" class="button primary mt12" style="width:100%">Share this scenario</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Share Modal -->
  <div id="shareOverlay" class="overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modal-head">
        <div class="muted small" id="shareTitle">Share — Mobile portrait (1080×1920)</div>
        <div class="row">
          <button id="dlPng" class="button primary">Download PNG</button>
          <button id="openNew" class="button">Open in new tab</button>
          <button id="copyB64" class="button">Copy Base64</button>
          <button id="shareClose" class="button">Close</button>
        </div>
      </div>
      <div class="modal-body">
        <div class="stat" style="margin:auto;max-width:720px">
          <canvas id="shareCanvas" width="1080" height="1920" class="ring" style="border-radius:12px;max-width:100%;display:block;margin:0 auto"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- EMI + Litres Modal -->
  <div id="toolsOverlay" class="overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modal-head">
        <div class="muted small">EMI & Litres Saved</div>
        <div class="row"><button id="toolsInfo" class="button">Info</button><button id="shareEmi" class="button">Share EMI card</button><button id="toolsClose" class="button">Close</button></div>
      </div>
      <div class="modal-body">
        <div class="toolsGrid">
          <div class="toolTile emi">
            <h3>EMI helper</h3>
            <div class="row mt8" style="align-items:center">
              <svg class="gauge" viewBox="0 0 120 120" style="margin-right:8px">
                <circle cx="60" cy="60" r="50" fill="none" stroke="rgba(255,255,255,.55)" stroke-width="12"/>
                <g transform="rotate(-90 60 60)">
                  <circle id="emiProg" cx="60" cy="60" r="50" fill="none" stroke="#ffffff" stroke-width="12" stroke-linecap="round" stroke-dasharray="0 314"/>
                </g>
                <text id="emiLabel" x="60" y="56" text-anchor="middle" fill="#fff" font-size="20" font-weight="800">—</text>
                <text x="60" y="78" text-anchor="middle" fill="rgba(255,255,255,.95)" font-size="12">EMI coverage</text>
              </svg>
              <div style="flex:1"></div>
            </div>
            <div class="row mt8">
              <div style="flex:1">
                <div class="small">Loan amount (₹)</div>
                <input id="emiAmount" class="input mt8" type="number" placeholder="500000" />
              </div>
              <div style="width:140px">
                <div class="small">Interest %</div>
                <input id="emiRate" class="input mt8" type="number" step="0.1" placeholder="9.5" />
              </div>
              <div style="width:160px">
                <div class="small">Months</div>
                <input id="emiMonths" class="input mt8" type="number" placeholder="60" />
              </div>
            </div>
            <div class="row mt16">
              <div>
                <div class="small">EMI / month</div>
                <div id="emiOut" class="value tabnums">—</div>
              </div>
              <div>
                <div class="small">Fuel savings / month</div>
                <div id="savingsOut" class="value tabnums">—</div>
              </div>
            </div>
            <div id="emiTip" class="small mt12" style="opacity:.9">Enter values to compare your EMI vs monthly fuel savings.</div>
          </div>

          <div class="toolTile litres">
            <h3>Litres saved / month</h3>
            <div class="row mt8">
              <div>
                <div class="small">Your monthly km</div>
                <div id="lsKm" class="value tabnums">—</div>
              </div>
              <div>
                <div class="small">Segment km/L</div>
                <div id="lsKmpl" class="value tabnums">—</div>
              </div>
            </div>
            <div class="mt16">
              <div class="small">Estimated petrol you avoid each month</div>
              <div id="lsLitres" class="value tabnums" style="font-size:32px">—</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Info Modal -->
  <div id="infoOverlay" class="overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modal-head">
        <div class="muted small" id="infoTitle">Info</div>
        <div class="row"><button id="infoClose" class="button">Close</button></div>
      </div>
      <div class="modal-body">
        <div id="infoContent" class="stat" style="max-width:820px;margin:auto;font-size:16px"></div>
      </div>
    </div>
  </div>

<script>
(function(){
  // -------- Data
  const BENCH_KMPL = {"City car":20,"Hatchback":17,"Compact SUV":16,"Sedan":16,"SUV":14,"Crossover":12,"MPV/SUV":15,"Scooter":50};

  // Cars (≤ ₹50L ex-showroom) — sample set
  const MODELS_CARS=[
    {id:"mahindra-be6",brand:"Mahindra",model:"BE 6",price_lakh:18.90,segment:"SUV",eff_kwh_per_100km:16.5,range_km:557},
    {id:"mahindra-xev9e",brand:"Mahindra",model:"XEV 9e",price_lakh:21.90,segment:"SUV",eff_kwh_per_100km:17.0,range_km:542},
